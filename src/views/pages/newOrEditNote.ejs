<!DOCTYPE html>
<html lang="en">

  <head>
    <%- include("../partials/head", { pageTitle: "New Note" }); %>
    <link rel="stylesheet" href="/css/note.css" />
    <link rel="stylesheet" href="/css/newOrEditNote.css" />
  </head>

  <body>
    <header>
      <%- include("../partials/navbar", { isAuthenticated: true }); %>
    </header>

    <div class="contentContainer">
      <% if (message) { %>
      <span class="message success"><%= message %></span>
      <% } %>

      <%- include("../partials/backLink", { href: "/notes" }) %>

      <h1><%= title %></h1>
      <hr />

      <form action="/notes/new" method="post">
        <% if (inEditMode) { %>
        <input type="hidden" name="id" value="<%= noteToEdit._id %>" />
        <% } %>

        <div class="inputGroup">
          <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required value="<%= noteToEdit ? noteToEdit.title : '' %>" />
          </div>
          <% if (errors?.title) { %>
          <span class="formError"><%= errors.title %></span>
          <% } %>
        </div>

        <div class="inputGroup">
          <div>
            <label for="tags">Tags:</label>
            <input type="text" id="tags" name="tags" placeholder="js, node, etc." value="<%= noteToEdit ? noteToEdit.tags : '' %>" />
          </div>
        </div>

        <div class="textareaGroup">
          <div>
            <label for="noteContent">Note:</label>
            <textarea name="noteContent" id="noteContent" rows="10" required placeholder="markdown format supported"><%= noteToEdit ? noteToEdit.content : '' %></textarea>
          </div>
          <% if (errors?.noteContent) { %>
          <span class="formError"><%= errors.noteContent %></span>
          <% } %>
        </div>

        <div class="formActionBtnsContainer">
          <button class="createOrEditNoteBtn">
            <% if (inEditMode) { %>
            Update Note
            <% } else { %>
            Create Note
            <% } %>
          </button>
          <button class="previewNoteBtn spinnerBtn" id="previewNoteBtn">
            <span id="btnText" class="btnText">Preview Note</span>
            <svg class="spinner" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise" width="24" height="22" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M4.05 11a8 8 0 1 1 .5 4m-.5 5v-5h5" />
            </svg>
          </button>
        </div>
      </form>
    </div>

    <div class="notePreviewContainer" id="notePreviewContainer">
      <div class="notePreviewModal" id="notePreviewModal"></div>
    </div>

    <%- include("../partials/footer"); %>

    <script src="/js/newOrEditNote.js"></script>
  </body>

</html>